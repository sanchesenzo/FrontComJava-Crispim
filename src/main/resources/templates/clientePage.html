<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard | Clientes</title>

  <style>
    /* 1. Importação da Fonte e Variáveis */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

    :root {
      --cor-fundo-light: #f4f7fa; /* Fundo principal (quase branco) */
      --cor-fundo-dark: #1f2937;  /* Fundo da sidebar */
      --cor-fundo-dark-hover: #374151;
      --cor-superficie: #ffffff;  /* Card, Modal */
      --cor-primaria: #6366f1;   /* Roxo/Índigo */
      --cor-primaria-hover: #4f46e5;
      --cor-texto-light: #f9fafb; /* Texto na sidebar */
      --cor-texto-dark: #374151;  /* Texto principal */
      --cor-texto-secundario: #6b7280;
      --cor-borda: #e5e7eb;
      --cor-perigo: #ef4444;
      --cor-perigo-hover: #dc2626;
      --cor-info: #3b82f6;
      --cor-info-hover: #2563eb;
      --sombra: 0 10px 15px -3px rgba(0, 0, 0, 0.07), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    /* 2. Reset e Globais */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background-color: var(--cor-fundo-light);
      color: var(--cor-texto-dark);
      line-height: 1.5;
      /* Trava o scroll quando o modal estiver aberto */
      overflow: hidden; 
    }
    button, input, select {
      font-family: inherit;
    }

    /* 3. Layout Principal (Sidebar + Main) */
    .layout-container {
      display: grid;
      grid-template-columns: 260px 1fr; /* Sidebar fixa e conteúdo flexível */
      height: 100vh;
    }

    /* 4. Sidebar (Navegação) */
    .sidebar {
      background-color: var(--cor-fundo-dark);
      color: var(--cor-texto-light);
      padding: 2rem;
      display: flex;
      flex-direction: column;
      gap: 2.5rem;
    }
    .sidebar-logo {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--cor-superficie);
      text-align: center;
      text-decoration: none;
    }
    .sidebar-nav {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .sidebar-nav a {
      color: var(--cor-texto-secundario);
      text-decoration: none;
      font-weight: 500;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      transition: background-color 0.2s ease, color 0.2s ease;
    }
    .sidebar-nav svg {
      width: 20px;
      height: 20px;
    }
    .sidebar-nav a:hover {
      background-color: var(--cor-fundo-dark-hover);
      color: var(--cor-texto-light);
    }
    .sidebar-nav a.active {
      background-color: var(--cor-primaria);
      color: var(--cor-texto-light);
      font-weight: 600;
    }

    /* 5. Conteúdo Principal */
    .main-content {
      padding: 2.5rem 3rem;
      overflow-y: auto; /* Permite scroll só no conteúdo */
    }
    .main-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
    .main-title {
      font-size: 2rem;
      font-weight: 700;
    }
    
    /* 6. Tabela */
    .table-container {
      background-color: var(--cor-superficie);
      border-radius: 12px;
      box-shadow: var(--sombra);
      overflow: hidden; /* Para o border-radius funcionar na tabela */
    }
    table {
      width: 100%;
      border-collapse: separate; /* Chave para o estilo moderno */
      border-spacing: 0; 
    }
    thead th {
      background-color: var(--cor-fundo-light);
      padding: 1rem 1.5rem;
      text-align: left;
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--cor-texto-secundario);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    tbody tr {
      transition: background-color 0.15s ease-in-out;
    }
    tbody tr:hover {
      background-color: #fcfcff; /* Um hover muito sutil */
    }
    tbody td {
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid var(--cor-borda);
      font-weight: 500;
    }
    tbody tr:last-child td {
      border-bottom: none;
    }
    .table-actions {
      display: flex;
      gap: 0.75rem;
    }

    /* 7. Botões */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.65rem 1.25rem;
      font-size: 0.9rem;
      border-radius: 8px;
      cursor: pointer;
      border: none;
      transition: all 0.2s ease;
      font-weight: 600;
    }
    .btn svg {
      width: 16px;
      height: 16px;
    }
    .btn-primary { 
      background-color: var(--cor-primaria); 
      color: #ffffff; 
      box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.4);
    }
    .btn-primary:hover { 
      background-color: var(--cor-primaria-hover); 
      transform: translateY(-2px);
    }

    .btn-secondary {
      background-color: var(--cor-superficie);
      color: var(--cor-texto-dark);
      border: 1px solid var(--cor-borda);
    }
    .btn-secondary:hover { background-color: var(--cor-fundo-light); }

    .btn-icon {
      padding: 0.6rem;
      border-radius: 6px;
    }
    .btn-danger { 
      background-color: var(--cor-perigo); 
      color: #ffffff; 
    }
    .btn-danger:hover { background-color: var(--cor-perigo-hover); }
    
    .btn-info { 
      background-color: var(--cor-info); 
      color: #ffffff; 
    }
    .btn-info:hover { background-color: var(--cor-info-hover); }


    /* 8. Modal (A grande mudança) */
    .modal-backdrop {
      position: fixed;
      inset: 0; /* (top, right, bottom, left = 0) */
      background-color: rgba(31, 41, 55, 0.5); /* Fundo dark semi-transparente */
      backdrop-filter: blur(4px);
      display: grid;
      place-items: center;
      
      /* Controla visibilidade */
      visibility: hidden;
      opacity: 0;
      transition: visibility 0.2s ease, opacity 0.2s ease;
    }
    .modal-backdrop.active {
      visibility: visible;
      opacity: 1;
    }

    .modal {
      background-color: var(--cor-superficie);
      padding: 2.5rem;
      border-radius: 12px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      width: 100%;
      max-width: 500px;
      
      /* Animação de entrada */
      transform: scale(0.95);
      transition: transform 0.2s ease;
    }
    .modal-backdrop.active .modal {
      transform: scale(1);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
    .modal-title {
      font-size: 1.5rem;
      font-weight: 600;
    }
    .modal-close-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--cor-texto-secundario);
    }
    .modal-close-btn svg {
      width: 24px;
      height: 24px;
    }

    /* 9. Formulário (Dentro do Modal) */
    .form-group {
      margin-bottom: 1.5rem;
    }
    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      font-size: 0.9rem;
      color: var(--cor-texto-dark);
    }
    input, select {
      width: 100%;
      padding: 0.75rem 1rem;
      background-color: var(--cor-fundo-light);
      border: 1px solid var(--cor-borda);
      border-radius: 8px;
      color: var(--cor-texto-dark);
      font-size: 1rem;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    input:focus, select:focus {
      outline: none;
      border-color: var(--cor-primaria);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
    }
    .form-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end; /* Alinha botões à direita */
      margin-top: 2rem;
    }

    /* 10. Responsividade */
    @media (max-width: 768px) {
      .layout-container {
        grid-template-columns: 1fr; /* Coluna única */
      }
      .sidebar {
        /* Esconde a sidebar em mobile (para um app real, precisaria de um botão "hamburger") */
        display: none; 
      }
      .main-content {
        padding: 1.5rem;
      }
      .main-title {
        font-size: 1.5rem;
      }
      .modal {
        max-width: 90vw;
        padding: 1.5rem;
      }
    }

  </style>
</head>
<body>

  <div class="layout-container">
    <aside class="sidebar">
      <a href="#" class="sidebar-logo">TrabalhoCrispim</a>
      <nav>
        <ul class="sidebar-nav">
          <li>
            <a href="orcamentoPage.html">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
              Orçamentos
            </a>
          </li>
          <li>
            <a href="usuarioPage.html">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" /></svg>
              Usuários
            </a>
          </li>
          <li>
            <a href="clientePage.html" class="active">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 00-12.728 0M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096V10.5c0 .54-.384 1.006-.917 1.096A48.32 48.32 0 0112 12c-2.755 0-5.455-.232-8.083-.678-.533-.09-.917-.556-.917-1.096V4.774c0-.54.384-1.006.917-1.096A48.317 48.317 0 0112 3z" /></svg>
              Clientes
            </a>
          </li>
        </ul>
      </nav>
    </aside>

    <main class="main-content">
      <header class="main-header">
        <h1 class="main-title">Clientes</h1>
        <button id="btnNovoCliente" type="button" class="btn btn-primary">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m6-6H6" /></svg>
          Novo Cliente
        </button>
      </header>

      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Nome</th>
              <th>CPF</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="clienteTableBody">
            </tbody>
        </table>
      </div>
    </main>
  </div>

  <div class="modal-backdrop" id="clienteModalBackdrop">
    <div class="modal">
      <header class="modal-header">
        <h2 class="modal-title" id="modalTitle">Novo Cliente</h2>
        <button type="button" class="modal-close-btn" id="btnCloseModal">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
        </button>
      </header>
      
      <form id="clienteForm">
        <input type="hidden" id="id">
        <div class="form-group">
          <label for="nome">Nome do Cliente</label>
          <input type="text" id="nome" required placeholder="Nome completo">
        </div>
        <div class="form-group">
          <label for="cpf">CPF</label>
          <input type="text" id="cpf" required placeholder="000.000.000-00">
        </div>
        
        <div class="form-actions">
          <button id="btnCancelar" type="button" class="btn btn-secondary">Cancelar</button>
          <button id="btnSalvar" type="submit" class="btn btn-primary">
            Salvar
          </button>
        </div>
      </form>
    </div>
  </div>


  <script>
    // URL da API (como no original)
    const API_URL = '/api/clientes';

    // Elementos do DOM
    const clienteTableBody = document.getElementById('clienteTableBody');
    const clienteForm = document.getElementById('clienteForm');
    
    // Elementos do Modal
    const modalBackdrop = document.getElementById('clienteModalBackdrop');
    const modalTitle = document.getElementById('modalTitle');
    const btnNovoCliente = document.getElementById('btnNovoCliente');
    const btnCloseModal = document.getElementById('btnCloseModal');
    const btnCancelar = document.getElementById('btnCancelar');
    
    // --- Funções do Modal ---

    const openModal = (mode = 'create', cliente = null) => {
      // Trava o scroll do body
      document.body.style.overflow = 'hidden'; 

      if (mode === 'edit') {
        modalTitle.textContent = 'Editar Cliente';
        populateForm(cliente);
      } else {
        modalTitle.textContent = 'Novo Cliente';
        clearForm();
      }
      modalBackdrop.classList.add('active');
    };

    const closeModal = () => {
      // Libera o scroll do body
      document.body.style.overflow = 'auto'; 

      modalBackdrop.classList.remove('active');
      clearForm();
    };

    const populateForm = (cliente) => {
      document.getElementById('id').value = cliente.id;
      document.getElementById('nome').value = cliente.nome;
      document.getElementById('cpf').value = cliente.cpf;
    };

    const clearForm = () => {
      clienteForm.reset();
      document.getElementById('id').value = '';
    };
    
    // --- Funções de API (CRUD) ---

    /**
     * Busca todos os clientes e renderiza a tabela.
     */
    const fetchAndRenderTable = async () => {
      try {
        const response = await fetch(API_URL);
        if (!response.ok) throw new Error('Falha ao buscar clientes');
        const clientes = await response.json();
        
        clienteTableBody.innerHTML = ''; // Limpa a tabela
        
        if (clientes.length === 0) {
          clienteTableBody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 2rem;">Nenhum cliente cadastrado.</td></tr>';
          return;
        }

        clientes.forEach(cliente => {
          const row = `
            <tr>
              <td>#${cliente.id}</td>
              <td>${cliente.nome}</td>
              <td>${cliente.cpf}</td>
              <td class="table-actions">
                <button class="btn btn-icon btn-info" onclick="initEdit(${cliente.id})">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" /></svg>
                </button>
                <button class="btn btn-icon btn-danger" onclick="deleteCliente(${cliente.id})">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12.56 0c.342.052.682.107 1.022.166m11.538 0l-2.094-1.995c-.372-.353-.83-.599-1.33-.708L10.5 2.25H13.5c.502 0 .96.246 1.33.708l2.094 1.995z" /></svg>
                </button>
              </td>
            </tr>
          `;
          clienteTableBody.insertAdjacentHTML('beforeend', row);
        });
      } catch (error) {
        console.error('Erro ao carregar a tabela de clientes:', error);
        clienteTableBody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: var(--cor-perigo); padding: 2rem;">Falha ao carregar dados.</td></tr>';
      }
    };

    /**
     * Inicia a edição: busca o cliente e abre o modal.
     */
    const initEdit = async (id) => {
      try {
        const response = await fetch(`${API_URL}/${id}`);
        if (response.ok) {
          const cliente = await response.json();
          openModal('edit', cliente);
        } else {
          alert('Cliente não encontrado.');
        }
      } catch (error) {
        console.error('Erro ao buscar cliente para edição:', error);
      }
    };

    /**
     * Exclui um cliente.
     */
    const deleteCliente = async (id) => {
      if (confirm('Tem certeza que deseja excluir este cliente?')) {
        try {
          const response = await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
          if (response.ok) {
            fetchAndRenderTable();
          } else {
            alert('Erro ao excluir cliente.');
          }
        } catch (error) {
          console.error('Erro ao excluir:', error);
        }
      }
    };

    /**
     * Handler para o submit do formulário (Criar ou Atualizar).
     */
    clienteForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const id = document.getElementById('id').value;
      const clienteData = {
        nome: document.getElementById('nome').value,
        cpf: document.getElementById('cpf').value,
      };

      if (id) {
        clienteData.id = id;
      }

      try {
        const response = await fetch(API_URL, {
          method: 'POST', // O seu backend original parecia usar POST para ambos
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(clienteData),
        });

        if (!response.ok) {
          throw new Error('Falha ao salvar. Status: ' + response.status);
        }

        closeModal();
        fetchAndRenderTable();
        alert(id ? 'Cliente atualizado com sucesso!' : 'Cliente cadastrado com sucesso!');
      
      } catch (error) {
        console.error('Erro ao salvar cliente:', error);
        alert('Ocorreu um erro ao salvar o cliente.');
      }
    });

    // --- Listeners de Eventos ---

    // Abrir modal para criar
    btnNovoCliente.addEventListener('click', () => openModal('create'));

    // Fechar modal
    btnCloseModal.addEventListener('click', closeModal);
    btnCancelar.addEventListener('click', closeModal);
    
    // Fechar modal clicando no fundo
    modalBackdrop.addEventListener('click', (e) => {
      if (e.target === modalBackdrop) {
        closeModal();
      }
    });

    // Carregamento inicial
    document.addEventListener('DOMContentLoaded', fetchAndRenderTable);
  </script>

</body>
</html>